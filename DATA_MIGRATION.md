# データ移行ガイド

このガイドでは、既存のスプレッドシートデータをデータベースに移行する手順を説明します。

## 📋 移行手順

### 1. マスターデータの移行

まず、基本的なマスターデータ（作業者、客先、機械、工番）を移行します：

```bash
# データベースにマスターデータを移行
npm run db:migrate-data
```

このコマンドにより、以下のデータが移行されます：
- **作業者**: 9名
- **客先**: 7社
- **機械種類**: 12種類
- **工番**: 13件
- **サンプル日報データ**: 20件

### 2. スプレッドシートデータの準備

スプレッドシートのデータを以下の形式でCSVにエクスポートしてください：

#### 必要なカラム
| カラム名 | 説明 | 必須 | 例 |
|---------|------|------|-----|
| date | 日付 (YYYY-MM-DD) | ○ | 2024-12-01 |
| workerName | 作業者名 | ○ | 橋本正朗 |
| customerName | 客先名 | ○ | ㈱TMT |
| workNumberFront | 工番（前） | ○ | 5927 |
| workNumberBack | 工番（後） | ○ | 13343 |
| workName | 作業名 | ○ | テーパープラグ |
| startTime | 開始時刻 (HH:MM) | ○ | 08:00 |
| endTime | 終了時刻 (HH:MM) | ○ | 12:00 |
| machineType | 機械種類 | ○ | スマート250 L : NC旋盤 |
| workStatus | 勤務状況 | × | normal |
| remarks | 備考 | × | 昼残 |

#### サンプルCSV
```csv
date,workerName,customerName,workNumberFront,workNumberBack,workName,startTime,endTime,machineType,workStatus,remarks
2024-12-01,橋本正朗,㈱TMT,5927,13343,テーパープラグ,08:00,12:00,スマート250 L : NC旋盤,normal,
2024-12-01,橋本正朗,㈱TMT,5927,13278,スリーブ,13:00,17:00,350 : NC旋盤マザック,normal,
2024-12-02,常世田博,㈱天昌電機社,5927,13314,ピン,08:00,14:00,250 : NC旋盤マザック,lunch_overtime,昼残
```

### 3. データ移行ツールの使用

1. アプリケーションにアクセス
2. ナビゲーションから「データ移行」を選択
3. 以下のいずれかの方法でデータをアップロード：
   - **CSVファイルのアップロード**: ファイルを選択してアップロード
   - **CSVデータの直接入力**: テキストエリアにCSVデータを貼り付け

### 4. データ検証

移行ツールは以下の項目を自動的に検証します：

- **必須フィールドの存在確認**
- **日付フォーマットの検証** (YYYY-MM-DD)
- **時刻フォーマットの検証** (HH:MM)
- **マスターデータとの整合性確認**

### 5. 移行結果の確認

移行完了後、以下の情報が表示されます：

- 総日報数
- 総作業項目数
- インポート成功件数
- スキップされた項目数
- エラー詳細（ある場合）

## ⚠️ 注意事項

### データの整合性
- 作業者名、客先名、機械種類は既存のマスターデータと完全に一致する必要があります
- 工番（前番号・後番号）の組み合わせは既存の工番データと一致する必要があります

### 重複データの処理
- 同じ日付・同じ作業者の組み合わせで既に日報が存在する場合、新しいデータは作成されません
- 工番が存在しない場合、該当する作業項目はスキップされます

### データ形式
- 日付は必ず `YYYY-MM-DD` 形式で入力してください
- 時刻は必ず `HH:MM` 形式で入力してください（24時間形式）
- 文字エンコーディングは UTF-8 を使用してください

## 🔧 トラブルシューティング

### よくあるエラー

1. **「作業者が見つかりません」**
   - 作業者名がマスターデータと完全に一致しているか確認
   - 全角・半角、スペースの有無を確認

2. **「客先が見つかりません」**
   - 客先名がマスターデータと完全に一致しているか確認
   - 会社名の表記（㈱、株式会社など）を確認

3. **「機械種類が見つかりません」**
   - 機械種類名がマスターデータと完全に一致しているか確認
   - 型番やカテゴリ名の表記を確認

4. **「工番が見つかりません」**
   - 工番の前番号・後番号が正しく入力されているか確認
   - 既存の工番データに存在する組み合わせか確認

### データ修正方法

1. **マスターデータの追加**
   - 新しい作業者、客先、機械、工番が必要な場合は、まずマスターデータを追加
   - データベース管理画面から手動で追加可能

2. **CSVデータの修正**
   - エラーメッセージに従ってCSVデータを修正
   - 再度アップロードを実行

## 📊 移行後の確認

移行完了後、以下の項目を確認してください：

1. **日報一覧画面**で移行されたデータが表示されるか
2. **データベース管理画面**でレコード数が正しく増加しているか
3. **Prisma Studio**でデータの詳細を確認

```bash
# Prisma Studioでデータベースを確認
npm run db:studio
```

## 🆘 サポート

データ移行で問題が発生した場合は、以下を確認してください：

1. エラーメッセージの詳細
2. CSVデータの形式
3. マスターデータとの整合性
4. データベースの接続状況

必要に応じて、開発チームにサポートを依頼してください。
